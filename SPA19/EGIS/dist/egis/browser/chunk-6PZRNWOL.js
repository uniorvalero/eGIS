import{a as Je}from"./chunk-FKZPGAO2.js";import{a as j}from"./chunk-XFUHRFGG.js";import{a as Ke}from"./chunk-IBAYAYJH.js";import{a as $}from"./chunk-GRYVUB4F.js";import{a as He,b as Qe,c as Ge,h as qe}from"./chunk-QPQHFBXO.js";import{d as ze,e as Ye}from"./chunk-DBLGM7RZ.js";import{a as Ae,b as U,c as Ue,e as $e,h as je}from"./chunk-V5IDTODI.js";import"./chunk-F5X5MWHG.js";import"./chunk-MS4AQ6UA.js";import{a as Oe,b as ke,c as G,e as Re,f as Be,g as Fe,h as Le}from"./chunk-4QXU7Q3Z.js";import{G as Te,I as Ve,J as Ne,e as A,f as Ce,g as he,i as _e,j as Se,l as xe,m as Pe,o as be,p as Me,r as De,s as Ie,t as Ee,u as we}from"./chunk-MYHFZ2D2.js";import"./chunk-3RK6DDJD.js";import{$ as N,b as oe,da as ye,g as re,ga as O,h as me,ka as ge,l as le,la as k,m as se,ma as R,n as de,o as pe,p as ce,pa as ve,q as ue,ra as B,s as fe,sa as F}from"./chunk-KTJ4FNCK.js";import{a as ae}from"./chunk-IKLMD3RG.js";import{m as ie,p as V,s as ne,t as P}from"./chunk-T6TR6RQX.js";import{$ as K,Bb as o,Cb as e,Db as h,Eb as v,Fb as C,Hb as b,Lb as g,Mb as M,Qb as D,Rb as I,Sb as E,Va as m,Vb as T,W as J,Wb as n,Xb as X,Yb as l,_a as u,a as z,ab as W,cc as Z,dc as ee,fb as S,fc as x,gc as w,hc as te,ia as f,ja as y,lb as p,sb as d,w as Y}from"./chunk-5MRHDFKX.js";function mt(a,t){if(a&1&&(o(0,"mat-option",19),n(1),e()),a&2){let r=t.$implicit;d("value",r),m(),l(" ",r," ")}}function lt(a,t){if(a&1&&(o(0,"mat-option",19),n(1),e()),a&2){let r=t.$implicit;d("value",r.id),m(),l(" ",r.userName," ")}}function st(a,t){if(a&1&&(o(0,"mat-option",19),n(1),e()),a&2){let r=t.$implicit;d("value",r.name),m(),l(" ",r.name," ")}}function dt(a,t){if(a&1&&(o(0,"mat-option",19),n(1),e()),a&2){let r=t.$implicit;d("value",r.id),m(),l(" ",r.userName," ")}}var L=class a{constructor(t,r,i,s,c){this.fb=t;this.dialogRef=r;this.data=i;this.usersService=s;this.taxComputationService=c;this.isEditMode=!!i.Id,this.form=this.fb.group({taxId:[null],payerId:[null],paymentDate:[i.paymentDate],amountPaid:[i.amountPaid||0],paymentMethod:[i.paymentMethod||""],receiptNo:[i.receiptNo||null],verifiedBy:[null]}),this.loadVerifiers(),this.loadPayer(),this.loadTax(),this.loadPaymentMethod()}form;isEditMode;userPayer="Payer";userVerifier="Verifier";computted="Computted";pending="Pending";users=[];verifiers=[];Taxes=[];selectedUser=null;selectedVerifier=null;clasificationOptions=[{name:"GCash"},{name:"Online Bank Transfer"},{name:"Cash"},{name:"Check"},{name:"Credit Card"},{name:"Debit Card"},{name:"Mobile Payment"}];loadVerifiers(){this.usersService.getUserIDName(this.userVerifier).subscribe(t=>{this.verifiers=t,this.data.verifiedBy&&this.onSelectedVerifier(this.data.verifiedBy)})}loadPayer(){this.usersService.getUserIDName(this.userPayer).subscribe(t=>{this.users=t})}loadTax(){this.taxComputationService.getAllApprovedTaxId(this.computted).subscribe(t=>{this.Taxes=t})}loadPaymentMethod(){this.form.patchValue({paymentMethod:this.data.paymentMethod||""})}onSelectedVerifier(t){let r=this.verifiers.find(i=>i.id===t);this.selectedVerifier=r||null,this.form.patchValue({verifiedBy:t})}onSelectedPayer(t){let r=this.users.find(i=>i.id===t);this.selectedUser=r||null,this.form.patchValue({payerId:t})}onSubmit(){let t=z({},this.form.value);if(this.form.valid){if(t.paymentDate instanceof Date){let r=t.paymentDate.getFullYear(),i=String(t.paymentDate.getMonth()+1).padStart(2,"0"),s=String(t.paymentDate.getDate()).padStart(2,"0");t.paymentDate=`${r}-${i}-${s}`}this.dialogRef.close(t)}}onCancel(){this.dialogRef.close()}static \u0275fac=function(r){return new(r||a)(u(ue),u(Ae),u(U),u($),u(j))};static \u0275cmp=S({type:a,selectors:[["app-payments-dialog"]],features:[Z([Ye()])],decls:45,vars:10,consts:[["picker",""],[1,"container-fluid"],["mat-dialog-title",""],[1,"form-container",3,"ngSubmit","formGroup"],[1,"form-grid"],[1,"full-width"],["formControlName","taxId","required",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","payerId",3,"selectionChange"],["matInput","","formControlName","paymentDate",3,"matDatepicker"],["matSuffix","",3,"for"],["appearance","fill",1,"form-field"],["matInput","","formControlName","amountPaid","type","number"],["formControlName","paymentMethod"],["matInput","","formControlName","receiptNo","type","number"],["formControlName","verifiedBy",3,"selectionChange"],[1,"dialog-actions"],["mat-button","","type","button",3,"click"],["mat-raised-button","","type","submit",3,"disabled"],[3,"value"]],template:function(r,i){if(r&1){let s=b();o(0,"div",1)(1,"h2",2),n(2),e(),o(3,"form",3),g("ngSubmit",function(){return f(s),y(i.onSubmit())}),o(4,"div",4)(5,"mat-form-field",5)(6,"mat-label"),n(7,"Select Tax ID"),e(),o(8,"mat-select",6),p(9,mt,2,2,"mat-option",7),e()(),o(10,"mat-form-field",5)(11,"mat-label"),n(12,"Select Payer"),e(),o(13,"mat-select",8),g("selectionChange",function(_){return f(s),y(i.onSelectedPayer(_.value))}),p(14,lt,2,2,"mat-option",7),e()(),o(15,"mat-form-field",5)(16,"mat-label"),n(17,"Payment Date"),e(),h(18,"input",9)(19,"mat-datepicker-toggle",10)(20,"mat-datepicker",null,0),e(),o(22,"mat-form-field",11)(23,"mat-label"),n(24,"Amount Paid"),e(),h(25,"input",12),e(),o(26,"mat-form-field",5)(27,"mat-label"),n(28,"Payment Method"),e(),o(29,"mat-select",13),p(30,st,2,2,"mat-option",7),e()(),o(31,"mat-form-field",11)(32,"mat-label"),n(33,"Receipt No"),e(),h(34,"input",14),e(),o(35,"mat-form-field",5)(36,"mat-label"),n(37,"Select Verifier"),e(),o(38,"mat-select",15),g("selectionChange",function(_){return f(s),y(i.onSelectedVerifier(_.value))}),p(39,dt,2,2,"mat-option",7),e()()(),o(40,"div",16)(41,"button",17),g("click",function(){return f(s),y(i.onCancel())}),n(42,"Cancel"),e(),o(43,"button",18),n(44),e()()()()}if(r&2){let s=T(21);m(2),l("",i.isEditMode?"Edit":"Add"," Payment"),m(),d("formGroup",i.form),m(6),d("ngForOf",i.Taxes),m(5),d("ngForOf",i.users),m(4),d("matDatepicker",s),m(),d("for",s),m(11),d("ngForOf",i.clasificationOptions),m(9),d("ngForOf",i.verifiers),m(4),d("disabled",!i.form.valid),m(),X(i.isEditMode?"Update":"Create")}},dependencies:[P,ie,fe,le,oe,se,re,me,ce,de,pe,R,k,O,N,ye,qe,He,Qe,Ge,ge,F,B,je,$e,ze,Ne,Ve,Te],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;align-items:center;justify-content:center;height:100%;padding:10px}.full-width[_ngcontent-%COMP%]{width:100%}mat-dialog-content[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:200px}mat-dialog-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}mat-form-field[_ngcontent-%COMP%]{width:100%;padding:10px}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:16px}.dialog-actions[_ngcontent-%COMP%]{margin-top:24px;display:flex;justify-content:flex-end;gap:12px}"],changeDetection:0})};var H=class a{constructor(t,r,i,s,c){this.payment=t;this.usersService=r;this.propertyService=i;this.assessmentService=s;this.taxComputationService=c}ledger={};ngOnInit(){this.loadLedger()}loadLedger(){let t=this.payment.payerId,r=this.payment.taxId,i=this.payment.id;Y({user:this.usersService.getUserById(t),property:this.propertyService.getPropertyById(r),assessment:this.assessmentService.getAssessmentById(r),taxComputation:this.taxComputationService.getTaxByPaymentId(i)}).subscribe(({user:s,property:c,assessment:_,taxComputation:et})=>{this.ledger={user:s,property:c,assessment:_,taxComputation:et,payment:this.payment}})}static \u0275fac=function(r){return new(r||a)(u(U),u($),u(Je),u(Ke),u(j))};static \u0275cmp=S({type:a,selectors:[["app-payments-ledgers-dialog"]],decls:96,vars:21,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"ledger-table"],["mat-dialog-actions","","align","end"],["mat-button","","mat-dialog-close",""]],template:function(r,i){r&1&&(o(0,"h2",0),n(1,"Payments Ledger Report"),e(),o(2,"div",1)(3,"table",2)(4,"thead")(5,"tr")(6,"th"),n(7,"User"),e(),o(8,"th"),n(9,"Property"),e(),o(10,"th"),n(11,"Assessment"),e(),o(12,"th"),n(13,"Tax Computation"),e(),o(14,"th"),n(15,"Payment"),e()()(),o(16,"tbody")(17,"tr")(18,"td")(19,"div")(20,"b"),n(21,"Name:"),e(),n(22),e(),o(23,"div")(24,"b"),n(25,"Email:"),e(),n(26),e()(),o(27,"td")(28,"div")(29,"b"),n(30,"Location:"),e(),n(31),e(),o(32,"div")(33,"b"),n(34,"Tax Dec No:"),e(),n(35),e(),o(36,"div")(37,"b"),n(38,"Title No:"),e(),n(39),e()(),o(40,"td")(41,"div")(42,"b"),n(43,"Assessed Value:"),e(),n(44),e(),o(45,"div")(46,"b"),n(47,"Assessed By:"),e(),n(48),e(),o(49,"div")(50,"b"),n(51,"Date:"),e(),n(52),x(53,"date"),e()(),o(54,"td")(55,"div")(56,"b"),n(57,"Tax Year:"),e(),n(58),e(),o(59,"div")(60,"b"),n(61,"Basic Tax:"),e(),n(62),e(),o(63,"div")(64,"b"),n(65,"Sef Tax:"),e(),n(66),e(),o(67,"div")(68,"b"),n(69,"Idle Land Tax:"),e(),n(70),e()(),o(71,"td")(72,"div")(73,"b"),n(74,"Date:"),e(),n(75),x(76,"date"),e(),o(77,"div")(78,"b"),n(79,"Amount Paid:"),e(),n(80),e(),o(81,"div")(82,"b"),n(83,"Method:"),e(),n(84),e(),o(85,"div")(86,"b"),n(87,"Receipt No:"),e(),n(88),e(),o(89,"div")(90,"b"),n(91,"Verified By:"),e(),n(92),e()()()()()(),o(93,"div",3)(94,"button",4),n(95,"Close"),e()()),r&2&&(m(22),l(" ",i.ledger.user==null?null:i.ledger.user.userName,""),m(4),l(" ",i.ledger.user==null?null:i.ledger.user.email,""),m(5),l(" ",i.ledger.property==null?null:i.ledger.property.location,""),m(4),l(" ",i.ledger.property==null?null:i.ledger.property.taxDeclarationNo,""),m(4),l(" ",i.ledger.property==null?null:i.ledger.property.titleNo,""),m(5),l(" ",i.ledger.assessment==null?null:i.ledger.assessment.assessedValue,""),m(4),l(" ",i.ledger.assessment==null?null:i.ledger.assessment.assessedByUserName,""),m(4),l(" ",w(53,17,i.ledger.assessment==null?null:i.ledger.assessment.assessmentDate),""),m(6),l(" ",i.ledger.taxComputation==null?null:i.ledger.taxComputation.taxYear,""),m(4),l(" ",i.ledger.taxComputation==null?null:i.ledger.taxComputation.basicTax,""),m(4),l(" ",i.ledger.taxComputation==null?null:i.ledger.taxComputation.sefTax,""),m(4),l(" ",i.ledger.taxComputation==null?null:i.ledger.taxComputation.idleLandTax,""),m(5),l(" ",w(76,19,i.ledger.payment==null?null:i.ledger.payment.paymentDate),""),m(5),l(" ",i.ledger.payment==null?null:i.ledger.payment.amountPaid,""),m(4),l(" ",i.ledger.payment==null?null:i.ledger.payment.paymentMethod,""),m(4),l(" ",i.ledger.payment==null?null:i.ledger.payment.receiptNo,""),m(4),l(" ",i.ledger.payment==null?null:i.ledger.payment.verifiedByUserName,""))},dependencies:[P,V],styles:["[_nghost-%COMP%]     .ledger-dialog-panel .mat-dialog-container{padding:0;border-radius:12px;overflow:auto}.ledger-table[_ngcontent-%COMP%]{width:100%;min-width:1200px;border-collapse:collapse;font-size:1rem}.ledger-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .ledger-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #ccc;padding:12px 10px;vertical-align:top}.ledger-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f5f5f5;font-size:1.1rem}mat-dialog-content[_ngcontent-%COMP%]{max-height:70vh;overflow:auto}"]})};var Q=class a{constructor(t){this.http=t}apibaseurl=Le.rptasfaasApiBaseURL;getAllPayments(){return this.http.get(this.apibaseurl+"/Payment")}updatePayments(t){return this.http.put(`${this.apibaseurl+"/Payment"}/${t.Id}`,t)}createPayments(t){return console.log("Creating payment with data:",t),this.http.post(this.apibaseurl+"/Payment/Create",t)}deletePayments(t){return this.http.delete(`${this.apibaseurl+"/Payment"}/${t}`)}static \u0275fac=function(r){return new(r||a)(K(ae))};static \u0275prov=J({token:a,factory:a.\u0275fac,providedIn:"root"})};var ct=["dynamicComponentContainer"],ut=()=>[5,10,25,100];function ft(a,t){a&1&&(o(0,"th",25),n(1," Payment ID "),e())}function yt(a,t){if(a&1&&(o(0,"td",26),n(1),e()),a&2){let r=t.$implicit;m(),l(" ",r.paymentId," ")}}function gt(a,t){a&1&&(o(0,"th",25),n(1," Tax ID "),e())}function vt(a,t){if(a&1&&(o(0,"td",26),n(1),e()),a&2){let r=t.$implicit;m(),l(" ",r.taxId," ")}}function Ct(a,t){a&1&&(o(0,"th",25),n(1," Payer ID "),e())}function ht(a,t){if(a&1&&(o(0,"td",26),n(1),e()),a&2){let r=t.$implicit;m(),l(" ",r.payerId," ")}}function _t(a,t){a&1&&(o(0,"th",25),n(1," Payment Date "),e())}function St(a,t){if(a&1&&(o(0,"td",26),n(1),x(2,"date"),e()),a&2){let r=t.$implicit;m(),l(" ",te(2,1,r.paymentDate,"shortDate")," ")}}function xt(a,t){a&1&&(o(0,"th",25),n(1," Amount Paid "),e())}function Pt(a,t){if(a&1&&(o(0,"td",26),n(1),x(2,"currency"),e()),a&2){let r=t.$implicit;m(),l(" ",w(2,1,r.amountPaid)," ")}}function bt(a,t){a&1&&(o(0,"th",25),n(1," Payment Method "),e())}function Mt(a,t){if(a&1&&(o(0,"td",26),n(1),e()),a&2){let r=t.$implicit;m(),l(" ",r.paymentMethod," ")}}function Dt(a,t){a&1&&(o(0,"th",25),n(1," Receipt No "),e())}function It(a,t){if(a&1&&(o(0,"td",26),n(1),e()),a&2){let r=t.$implicit;m(),l(" ",r.receiptNo," ")}}function Et(a,t){a&1&&(o(0,"th",25),n(1," Verified By "),e())}function wt(a,t){if(a&1&&(o(0,"td",26),n(1),e()),a&2){let r=t.$implicit;m(),l(" ",r.verifiedBy," ")}}function Tt(a,t){a&1&&(o(0,"th",27),n(1," Action "),e())}function Vt(a,t){if(a&1){let r=b();o(0,"td",28)(1,"button",29),g("click",function(){let s=f(r).$implicit,c=M();return y(c.paymentLedgers(s.id))}),o(2,"mat-icon"),n(3,"visibility"),e()(),o(4,"button",30),g("click",function(){let s=f(r).$implicit,c=M();return y(c.openDialog(s))}),o(5,"mat-icon"),n(6,"edit"),e()(),o(7,"button",31),g("click",function(){let s=f(r).$implicit,c=M();return y(c.deletePayment(s.id))}),o(8,"mat-icon"),n(9,"delete"),e()()()}}function Nt(a,t){a&1&&h(0,"tr",32)}function Ot(a,t){a&1&&h(0,"tr",33)}function kt(a,t){if(a&1&&(o(0,"tr",34)(1,"td",35),n(2),e()()),a&2){M();let r=T(11);m(2),l('No data matching the filter "',r.value,'"')}}var Ze=class a{constructor(t,r){this.paymentService=t;this.dialog=r}showSubCode=!1;selectedMasterCode;selectedDescription;displayedColumns=["paymentDate","amountPaid","paymentMethod","receiptNo","verifiedBy","actions"];dataSource;paginator;sort;table;container;ngOnInit(){this.loadPayment()}paymentLedgers(t){this.dialog.open(H,{data:t||{}}).afterClosed().subscribe(i=>{i&&this.paymentService.updatePayments(i).subscribe(()=>{this.loadPayment()})})}loadPayment(){this.paymentService.getAllPayments().subscribe(t=>{this.dataSource=new we(t),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort})}applyFilter(t){let r=t.target.value;this.dataSource.filter=r.trim().toLocaleLowerCase()}openDialog(t){this.dialog.open(L,{data:t||{}}).afterClosed().subscribe(i=>{i&&(i.id?this.paymentService.updatePayments(i).subscribe(()=>{this.loadPayment()}):this.paymentService.createPayments(i).subscribe(()=>{this.loadPayment()}))})}deletePayment(t){confirm("Are you sure you want to delete this payment?")&&this.paymentService.deletePayments(t).subscribe(()=>{this.loadPayment()})}static \u0275fac=function(r){return new(r||a)(u(Q),u(Ue))};static \u0275cmp=S({type:a,selectors:[["app-payments"]],viewQuery:function(r,i){if(r&1&&(D(G,5),D(Re,5),D(A,5),D(ct,5,W)),r&2){let s;I(s=E())&&(i.paginator=s.first),I(s=E())&&(i.sort=s.first),I(s=E())&&(i.table=s.first),I(s=E())&&(i.container=s.first)}},decls:45,vars:5,consts:[["input",""],[1,"table-container"],[1,"text-2xl","font-bold"],["mat-raised-button","","color","primary",3,"click"],[1,"full-width"],["matInput","","placeholder","Search payment...",3,"keyup"],[1,"mat-elevation-z8"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","paymentId"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","taxId"],["matColumnDef","payerId"],["matColumnDef","paymentDate"],["matColumnDef","amountPaid"],["matColumnDef","paymentMethod"],["matColumnDef","receiptNo"],["matColumnDef","verifiedBy"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","class","space-x-2",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["aria-label","Select page of payment",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-cell","",1,"space-x-2"],["mat-icon-button","","color","primary","matTooltip","View Payment Details",3,"click"],["mat-icon-button","","color","primary","matTooltip","Edit Payment",3,"click"],["mat-icon-button","","color","primary","matTooltip","Delete Payment",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","4",1,"mat-cell"]],template:function(r,i){if(r&1){let s=b();o(0,"div",1)(1,"div")(2,"h1",2),n(3,"Payment"),e(),o(4,"button",3),g("click",function(){return f(s),y(i.openDialog())}),n(5,"Add Payment"),e()(),o(6,"div")(7,"mat-form-field",4)(8,"mat-label"),n(9,"Filter"),e(),o(10,"input",5,0),g("keyup",function(_){return f(s),y(i.applyFilter(_))}),e()()(),o(12,"div",6)(13,"table",7),v(14,8),p(15,ft,2,0,"th",9)(16,yt,2,1,"td",10),C(),v(17,11),p(18,gt,2,0,"th",9)(19,vt,2,1,"td",10),C(),v(20,12),p(21,Ct,2,0,"th",9)(22,ht,2,1,"td",10),C(),v(23,13),p(24,_t,2,0,"th",9)(25,St,3,4,"td",10),C(),v(26,14),p(27,xt,2,0,"th",9)(28,Pt,3,3,"td",10),C(),v(29,15),p(30,bt,2,0,"th",9)(31,Mt,2,1,"td",10),C(),v(32,16),p(33,Dt,2,0,"th",9)(34,It,2,1,"td",10),C(),v(35,17),p(36,Et,2,0,"th",9)(37,wt,2,1,"td",10),C(),v(38,18),p(39,Tt,2,0,"th",19)(40,Vt,10,0,"td",20),C(),p(41,Nt,1,0,"tr",21)(42,Ot,1,0,"tr",22)(43,kt,3,1,"tr",23),e(),h(44,"mat-paginator",24),e()()}r&2&&(m(13),d("dataSource",i.dataSource),m(28),d("matHeaderRowDef",i.displayedColumns),m(),d("matRowDefColumns",i.displayedColumns),m(2),d("pageSizeOptions",ee(4,ut)))},dependencies:[O,R,k,N,Ee,A,he,Pe,_e,Ce,be,Se,xe,Me,De,Ie,Fe,Be,G,F,B,ve,ke,Oe,P,ne,V],styles:[".table-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-width:300px}  .mat-header-cell{background-color:#3f51b5;color:#fff;font-weight:700;font-size:16px;text-align:center}  .mat-header-row{height:56px}.full-width[_ngcontent-%COMP%]{width:100%}"]})};export{Ze as PaymentsComponent};
