import{a as G,b as Z}from"./chunk-AYQMUPGQ.js";import{a as J}from"./chunk-RDUXWVKY.js";import{b as A,c as F}from"./chunk-AWMIQM5V.js";import{c as P,f as O}from"./chunk-FE5V2QVG.js";import"./chunk-O27SARHL.js";import"./chunk-3RK6DDJD.js";import{a as N,b as U,c as W}from"./chunk-BUEFDGFJ.js";import"./chunk-SGYCFQGT.js";import"./chunk-HSUA2CKH.js";import"./chunk-TMATL23G.js";import{b as v,g as I,h as T,ha as z,j as k,l as V,m as B,oa as j,pa as R,s as D,ta as q,ua as L,w as E}from"./chunk-FPYKYBTQ.js";import{$b as f,Db as t,Eb as o,Fb as C,Jb as _,Kc as y,Lb as M,Mb as l,Rc as b,Wb as m,Ya as g,_b as u,ac as h,bb as c,ib as w,ka as p,la as d,nb as S,ub as x}from"./chunk-NKHI3LCY.js";function Y(r,i){if(r&1){let e=_();t(0,"form",6,0),M("ngSubmit",function(){p(e);let n=l();return d(n.onSendOTP())}),t(2,"mat-card")(3,"mat-card-content")(4,"div",7),C(5,"img",8),o(),t(6,"div",9),m(7,"Create your account."),o(),t(8,"mat-form-field",10)(9,"mat-label"),m(10,"Email"),o(),t(11,"input",11),h("ngModelChange",function(n){p(e);let s=l();return f(s.signupDetails.email,n)||(s.signupDetails.email=n),d(n)}),o()(),t(12,"mat-form-field",10)(13,"mat-label"),m(14,"Password"),o(),t(15,"input",12),h("ngModelChange",function(n){p(e);let s=l();return f(s.signupDetails.password,n)||(s.signupDetails.password=n),d(n)}),o()(),t(16,"button",13),m(17,"Send OTP"),o()()()()}if(r&2){let e=l();g(11),u("ngModel",e.signupDetails.email),g(4),u("ngModel",e.signupDetails.password)}}function H(r,i){if(r&1){let e=_();t(0,"form",14),M("ngSubmit",function(){p(e);let n=l();return d(n.onVerifyOtp())}),t(1,"div",15)(2,"span"),m(3,"An OTP code has been sent to your email. Please enter it below:"),o()(),t(4,"mat-form-field",10)(5,"mat-label"),m(6,"OTP Code"),o(),t(7,"input",16),h("ngModelChange",function(n){p(e);let s=l();return f(s.otpCode,n)||(s.otpCode=n),d(n)}),o()(),t(8,"button",17),m(9,"Verify OTP"),o()()}if(r&2){let e=l();g(7),u("ngModel",e.otpCode)}}var K=class r{constructor(i,e,a){this.authService=i;this.snackBar=e;this.router=a}captchaResolved=!1;siteKey="6LdltZIrAAAAAMZlfIBmtCWDl8pFJ4yYGiNGanR4";step=1;message="";otpTokenId;otpCode="";loginId=0;signupDetails={id:0,email:"",password:""};onSendOTP(){this.authService.signup(this.signupDetails).subscribe({next:i=>{this.otpTokenId=i.otpToken.id,this.loginId=i.otpToken.loginId,this.step=2,this.snackBar.open("OTP sent to your email.","Close",{duration:3e3})},error:i=>{console.error("Error occurred during signup:",i),this.snackBar.open("Signup failed: "+(i.error||i.message),"Close",{duration:3e3})}})}onVerifyOtp(){if(this.otpTokenId){let i={otpTokenId:this.otpTokenId,code:this.otpCode};this.authService.verifyOtp(i).subscribe({next:e=>{this.snackBar.open("OTP verified successfully! Please complete your details.","Close",{duration:3e3}),console.log("OTP verified, redirecting to user details step...",i.code,this.loginId),this.router.navigate(["userappstep"],{queryParams:{loginid:this.loginId,email:this.signupDetails.email}}),console.log("Redirecting to user details step with loginid:",this.loginId,"and email:",this.signupDetails.email)},error:e=>this.snackBar.open("OTP verification failed: "+(e.error||e.message),"Close",{duration:3e3})})}}static \u0275fac=function(e){return new(e||r)(c(J),c(G),c(P))};static \u0275cmp=w({type:r,selectors:[["app-user-signup"]],decls:5,vars:2,consts:[["loginForm","ngForm"],[1,"login-container"],[1,"login-theme"],[1,"login-form"],["autocomplete","off",3,"ngSubmit",4,"ngIf"],["autocomplete","off","class","otp-form",3,"ngSubmit",4,"ngIf"],["autocomplete","off",3,"ngSubmit"],[1,"logo-container"],["src","assets/images/sanpedro.png","alt","Logo",1,"login-logo"],[1,"form-title","centered-title"],["appearance","outline",1,"full-width","large-input"],["matInput","","type","email","name","email","required","","autocomplete","username",3,"ngModelChange","ngModel"],["matInput","","type","password","name","password","required","","autocomplete","new-password",3,"ngModelChange","ngModel"],["mat-raised-button","","color","primary","type","submit",1,"full-width","large-btn"],["autocomplete","off",1,"otp-form",3,"ngSubmit"],[1,"otp-instructions"],["matInput","","type","text","name","otp","required","","placeholder","Enter OTP",3,"ngModelChange","ngModel"],["mat-raised-button","","color","accent","type","submit",1,"full-width","large-btn"]],template:function(e,a){e&1&&(t(0,"div",1),C(1,"div",2),t(2,"div",3),S(3,Y,18,2,"form",4)(4,H,10,1,"form",5),o()()),e&2&&(g(3),x("ngIf",a.step===1),g(),x("ngIf",a.step===2))},dependencies:[E,B,v,I,T,D,V,k,b,y,L,q,j,z,F,A,W,N,U,R,Z,O],styles:[".login-container[_ngcontent-%COMP%]{display:flex;min-height:100vh;background:#f5f6fa}.login-theme[_ngcontent-%COMP%]{position:relative;flex:1;background:url(/assets/images/sanpedro-theme.png) center center no-repeat;background-size:cover;background-color:#f5f6fa;color:#222;display:flex;flex-direction:column;justify-content:center;align-items:flex-end;padding:48px 32px 48px 0;overflow:hidden}.theme-logo-container[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:0;width:100%;height:100%;opacity:.08;pointer-events:none;display:flex;justify-content:center;align-items:center}.theme-logo[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:contain;opacity:1;filter:grayscale(100%)}.theme-title[_ngcontent-%COMP%], .theme-desc[_ngcontent-%COMP%]{position:relative;z-index:1}.logo-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-bottom:18px}.login-logo[_ngcontent-%COMP%]{width:90px;height:auto;margin-bottom:8px}.theme-title[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700;margin-bottom:16px;text-align:right}.theme-desc[_ngcontent-%COMP%]{font-size:1.2rem;text-align:right;max-width:320px}.login-form[_ngcontent-%COMP%]{flex:0 0 520px;display:flex;align-items:center;justify-content:center;padding:48px 0 48px 32px;min-width:400px}mat-card[_ngcontent-%COMP%]{width:100%;max-width:520px;box-shadow:0 4px 24px #2803f714}.full-width[_ngcontent-%COMP%]{width:100%;min-width:320px;max-width:480px;display:block}.large-input[_ngcontent-%COMP%]{margin-bottom:10px}mat-form-field.large-input[_ngcontent-%COMP%]   .mat-mdc-form-field-infix[_ngcontent-%COMP%]{height:48px;font-size:1.08rem;border-radius:8px}.large-btn[_ngcontent-%COMP%]{height:48px;font-size:1.08rem;border-radius:8px;background:#234a96;color:#fff;margin-bottom:10px;text-transform:none;font-weight:600}.centered-title[_ngcontent-%COMP%]{text-align:left;font-size:1.18rem;font-weight:500;margin-bottom:18px;margin-left:2px}.otp-instructions[_ngcontent-%COMP%]{margin-bottom:16px;font-size:1rem;color:#555}.otp-form[_ngcontent-%COMP%]{margin-top:16px}"]})};export{K as UserSignupComponent};
